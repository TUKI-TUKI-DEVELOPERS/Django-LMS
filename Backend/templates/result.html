{% extends "base.html" %}
{% load i18n %}

{% load quiz_tags %}


{% block title %} {{ quiz.title}} | {% trans 'Learning management system' %} {% endblock %}
{% block description %} {% trans "Quiz Results for" %} {{ quiz.title }} {% endblock %}

{% block content %}

<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
	<ol class="breadcrumb">
		<li class="breadcrumb-item"><a href="/">{% trans 'Home' %}</a></li>
		<li class="breadcrumb-item"><a href="{% url 'course:programs' %}">{% trans 'Programs' %}</a></li>
		<li class="breadcrumb-item"><a href="{% url 'course:program_detail' course.program.id %}">{{ course.program }}</a></li>
		<li class="breadcrumb-item"><a href="{{ course.get_absolute_url }}">{{ course }}</a></li>
        <li class="breadcrumb-item"><a href="{% url 'quiz:quiz_index' course.slug %}">{% trans 'Quizzes' %}</a></li>
        <li class="breadcrumb-item"><a href="{% url 'quiz:quiz_take' course.id quiz.slug %}">{{ quiz.title|title }}</a></li>
		<li class="breadcrumb-item active" aria-current="page">{% trans 'Result' %}</li>
	</ol>
</nav>

<div id="progress-card">
  <div class="col-md-6 mx-auto">
    <h5 class="lead">{% trans 'Calculating your result...' %}</h5>
    <div class="progress">
      <div class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
    </div>
  </div>
</div>

<style>#progress-main{display: none;}</style>

<div class="container" id="progress-main">
  <style>
  :root { --navy:#202044; --lime:#92b62a; --glass:#ffffffef; --border:rgba(146,182,42,.15); }
  .result-glass{background:var(--glass);border:1px solid var(--border);border-radius:16px;box-shadow:0 12px 30px rgba(0,0,0,.08);padding:1.5rem}
  .title-xl{font-weight:800;font-size:1.8rem;background:linear-gradient(135deg,var(--navy),var(--lime));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  .pill{background:rgba(146,182,42,.1);color:var(--lime);border:1px solid var(--border);padding:.2rem .6rem;border-radius:999px;font-weight:700}
  .pill.bad{background:rgba(220,53,69,.08);color:#dc3545}
  .q-card{background:#fff;border:1px solid var(--border);border-radius:12px;margin:.5rem 0;overflow:hidden}
  .q-head{padding:.8rem 1rem;border-bottom:1px solid var(--border);font-weight:700;color:var(--navy)}
  .q-body{padding:1rem}
  </style>
  {% if previous.answers %}
    <div class="card bg-white p-3">
        <p class="muted"><small>{% trans "The previous question" %}:</small></p>
        <p>{{ previous.previous_question }}</p>
        <p>Your answer was
        <strong>
            {{ previous.previous_outcome|yesno:"correct,incorrect" }}
        </strong>
        </p>

        {% load i18n %}
        {% if previous.answers %}

          {% if user_was_incorrect %}
            <div class="alert alert-error">
              <strong>{% trans "You answered the above question incorrectly" %}</strong>
            </div>
          {% endif %}

          <table class="table table-striped table-bordered">
            <tbody>
              {% for answer in previous.answers %}
                {% if answer.correct %}
                  <tr class="success">
                    <td>{{ answer }}</td>
                  <td><strong>{% trans "This is the correct answer" %}</strong></td>
                  </tr>
                {% else %}
                  <tr>
                    <td>{{ answer }}</td>
                    <td>
                    {% if previous.question_type.MCQuestion %}
                      {% if answer.id|add:"0" == previous.previous_answer|add:"0" %}
                        {% trans "This was your answer." %}
                      {% endif %}
                    {% endif %}
                    </td>
                  {% endif %}
                  </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endif %}

        <p><strong>{% trans "Explanation" %}:</strong></p>
        <p class="p-2" style="background-color: #fcf8e3;">
          {% if previous.previous_question.explanation %}
            {{ previous.previous_question.explanation }}
          {% else %}
            {% trans "No explanation set to this question." %}
          {% endif %}
        </p>
        <hr>
    </div>

  {% endif %}

  {% if max_score %}

  <div class="result-glass mb-3">
    <div class="title-xl text-center">{% trans "Quiz result" %}</div>
    <div class="title-line"></div>
	<p class="text-center">
	  <small class="muted">{% trans "Quiz title" %}: </small>
	  <strong>{{ quiz.title }}</strong></p>

	<p class="lead text-center">
	  {% trans "You answered" %} {{ score }} {% trans "questions correctly out of" %} {{ max_score }}, {% trans "giving you" %} {{ percent }}{% trans "% correct" %}
    </p>

    <div class="mx-auto text-center" style="max-width:280px">
      <div class="progress" style="height:14px;background:#eceff1;border-radius:999px;box-shadow:inset 0 2px 4px rgba(0,0,0,.05)">
        <div class="progress-bar" role="progressbar" style="width: {{ percent }}%; background:linear-gradient(90deg, var(--lime), #a8c73a)"></div>
      </div>
      <div class="fw-bold mt-2">{{ percent }}%</div>
    </div><br>

	{% if quiz.pass_mark %}
  <div class="alert {% if percent >= quiz.pass_mark %}alert-success{% else %}alert-danger{% endif %}">
    {{ sitting.result_message }}
    {% endif %}
    <ul>
      <li>{% trans "Review the questions below and try the quiz again in the future"%}.</li>
      <li>
        {% trans "The result of this quiz will be stored in your progress section" %} 
       <a class="text-primary" href="{% url 'quiz:quiz_progress' %}">Here</a> 
        {% trans "so you can review and monitor your progression" %}.
      </li>
    </ul>

  </div>

  {% endif %}

  <hr>

  {% if possible %}

  <p class="lead">
	{% trans "Your session score is" %} {{ session }} {% trans "out of a possible" %} {{ possible }}
  </p>

  <hr>

  {% endif %}

  {% if questions %}
  <div class="result-glass">
    <h2 class="mb-3">Overview</h2>
    {% for question in questions %}

      <div class="q-card">
        <div class="q-head">{{ forloop.counter }}. {{ question.content }}</div>
        <div class="q-body">

	  <p><strong>{% trans "Explanation" %}:</strong></p>
    {% if question.explanation %}
    <p class="p-2 alert alert-info">
      {{ question.explanation|safe }}
    </p>
    {% else %}
    <p class="p-2 alert alert-warning">
      {% trans "No explanation set for this question." %}
    </p>
    {% endif %}
    
    {% correct_answer_for_all question %}
    
    {% if question.user_answer %}
      <div class="mt-2"><span class="pill {% if question.id in incorrect_questions %}bad{% endif %}">
        {% if question.id in incorrect_questions %}{% trans 'Incorrecto' %}{% else %}{% trans 'Correcto' %}{% endif %}
      </span>
      <strong class="ms-2">{% trans "Your answer" %}:</strong> {{ question|answer_choice_to_string:question.user_answer }}</div>
    {% endif %}

        </div>
      </div>
  {% endfor %}
  </div>

  {% endif %}

</div>

{% endblock %}

{% block js %}
<script>
    // loader
    // document.getElementById('progress-main').style.display = 'none';
    var timer = setInterval(function(){
        document.getElementById('progress-card').style.display = 'none';
        document.getElementById('progress-main').style.display = 'block';
        clearInterval(timer)
    }, 8000);           
</script>
{% endblock js %}
