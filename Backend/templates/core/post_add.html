{% extends 'base.html' %}
{% load i18n %}
{% block title %}{{ title }} | Sistema de Gestión Académica{% endblock title %}
{% load crispy_forms_tags %}
{% load static %}

{% block content %}

<style>
	/* Modern Post Form Styles 2025 */
	.post-form-container {
		background: rgba(255, 255, 255, 0.95);
		backdrop-filter: blur(20px);
		border-radius: 16px;
		box-shadow: 0 8px 32px rgba(0,0,0,0.08);
		margin: 1rem;
		padding: 2rem;
	}

	/* Breadcrumb - Elegant */
	.breadcrumb {
		background: transparent;
		padding: 0;
		margin-bottom: 2rem;
	}

	.breadcrumb-item a {
		color: #92b62a;
		text-decoration: none;
		font-weight: 500;
		transition: color 0.3s ease;
	}

	.breadcrumb-item a:hover {
		color: #7a9a2a;
	}

	.breadcrumb-item.active {
		color: #6c757d;
	}

	/* Form Card */
	.form-card {
		background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(248,249,250,0.9) 100%);
		backdrop-filter: blur(10px);
		border: 1px solid rgba(146, 182, 42, 0.1);
		border-radius: 16px;
		box-shadow: 0 4px 20px rgba(0,0,0,0.05);
		overflow: hidden;
		transition: all 0.3s ease;
	}

	.form-card:hover {
		box-shadow: 0 8px 30px rgba(146, 182, 42, 0.15);
		border-color: rgba(146, 182, 42, 0.3);
	}

	/* Form Header */
	.form-header {
		background: linear-gradient(135deg, rgba(146, 182, 42, 0.1) 0%, rgba(122, 154, 42, 0.1) 100%);
		padding: 1.5rem;
		border-bottom: 1px solid rgba(146, 182, 42, 0.1);
		text-align: center;
	}

	.form-title {
		font-size: 1.5rem;
		font-weight: 600;
		color: #2c3e50;
		margin: 0;
		background: linear-gradient(135deg, #2c3e50 0%, #92b62a 100%);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-clip: text;
	}

	/* Form Body */
	.form-body {
		padding: 2rem;
	}

	/* Form Fields */
	.form-group {
		margin-bottom: 1.5rem;
	}

	.form-label {
		font-weight: 600;
		color: #2c3e50;
		margin-bottom: 0.5rem;
		font-size: 0.95rem;
	}

	.form-control {
		border: 1px solid rgba(146, 182, 42, 0.2);
		border-radius: 8px;
		padding: 0.75rem 1rem;
		font-size: 0.95rem;
		transition: all 0.3s ease;
		background: rgba(255, 255, 255, 0.9);
	}

	.form-control:focus {
		border-color: #92b62a;
		box-shadow: 0 0 0 0.2rem rgba(146, 182, 42, 0.25);
		background: white;
	}

	.form-select {
		border: 1px solid rgba(146, 182, 42, 0.2);
		border-radius: 8px;
		padding: 0.75rem 1rem;
		font-size: 0.95rem;
		transition: all 0.3s ease;
		background: rgba(255, 255, 255, 0.9);
	}

	.form-select:focus {
		border-color: #92b62a;
		box-shadow: 0 0 0 0.2rem rgba(146, 182, 42, 0.25);
		background: white;
	}

	textarea.form-control {
		min-height: 120px;
		resize: vertical;
	}

	/* Image Field Styles */
	input[type="file"].form-control {
		padding: 0.5rem;
		border: 2px dashed rgba(146, 182, 42, 0.3);
		background: rgba(146, 182, 42, 0.05);
		cursor: pointer;
		transition: all 0.3s ease;
	}

	input[type="file"].form-control:hover {
		border-color: rgba(146, 182, 42, 0.5);
		background: rgba(146, 182, 42, 0.1);
	}

	input[type="file"].form-control:focus {
		border-color: #92b62a;
		box-shadow: 0 0 0 0.2rem rgba(146, 182, 42, 0.25);
		background: white;
	}

	/* Image Preview */
	.image-preview {
		margin-top: 1rem;
		text-align: center;
	}

	.image-preview img {
		max-width: 100%;
		max-height: 200px;
		border-radius: 8px;
		box-shadow: 0 4px 12px rgba(0,0,0,0.1);
	}

	/* Form Buttons */
	.form-actions {
		display: flex;
		gap: 1rem;
		justify-content: flex-end;
		margin-top: 2rem;
		padding-top: 1.5rem;
		border-top: 1px solid rgba(146, 182, 42, 0.1);
	}

	.btn-save {
		background: linear-gradient(135deg, #92b62a 0%, #7a9a2a 100%);
		border: none;
		color: white;
		padding: 0.8rem 2rem;
		border-radius: 12px;
		font-weight: 600;
		transition: all 0.3s ease;
		box-shadow: 0 4px 15px rgba(146, 182, 42, 0.3);
	}

	.btn-save:hover {
		transform: translateY(-2px);
		box-shadow: 0 8px 25px rgba(146, 182, 42, 0.4);
		color: white;
	}

	.btn-cancel {
		background: rgba(108, 117, 125, 0.1);
		border: 1px solid rgba(108, 117, 125, 0.2);
		color: #6c757d;
		padding: 0.8rem 2rem;
		border-radius: 12px;
		font-weight: 600;
		transition: all 0.3s ease;
		text-decoration: none;
		display: inline-block;
	}

	.btn-cancel:hover {
		background: rgba(108, 117, 125, 0.2);
		color: #495057;
		transform: translateY(-2px);
		text-decoration: none;
	}

	/* Help Text */
	.form-text {
		color: #6c757d;
		font-size: 0.85rem;
		margin-top: 0.25rem;
	}

	/* Error Messages */
	.invalid-feedback {
		color: #dc3545;
		font-size: 0.85rem;
		margin-top: 0.25rem;
	}

	/* Responsive */
	@media (max-width: 768px) {
		.post-form-container {
			margin: 0.5rem;
			padding: 1rem;
		}
		
		.form-body {
			padding: 1.5rem;
		}
		
		.form-actions {
			flex-direction: column;
		}
		
		.btn-save, .btn-cancel {
			width: 100%;
			text-align: center;
		}
	}
</style>

<div class="post-form-container">
	<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
		<ol class="breadcrumb">
		  <li class="breadcrumb-item"><a href="/">Inicio</a></li>
		  <li class="breadcrumb-item active" aria-current="page">Formulario de Publicación</li>
		</ol>
	</nav>

	{% include 'snippets/messages.html' %}

	<div class="row justify-content-center">
		<div class="col-lg-8 col-md-10">
			<div class="form-card">
				<div class="form-header">
					<h2 class="form-title">Formulario de Publicación</h2>
				</div>
				
				<div class="form-body">
					<form action="" method="POST" enctype="multipart/form-data">
						{% csrf_token %}
						
						<div class="form-group">
							<label for="{{ form.title.id_for_label }}" class="form-label">
								<i class="fas fa-heading me-2"></i>Título
							</label>
							{{ form.title }}
							{% if form.title.help_text %}
							<div class="form-text">{{ form.title.help_text }}</div>
							{% endif %}
							{% if form.title.errors %}
							<div class="invalid-feedback">{{ form.title.errors.0 }}</div>
							{% endif %}
						</div>

						<div class="form-group">
							<label for="{{ form.summary.id_for_label }}" class="form-label">
								<i class="fas fa-align-left me-2"></i>Resumen
							</label>
							{{ form.summary }}
							{% if form.summary.help_text %}
							<div class="form-text">{{ form.summary.help_text }}</div>
							{% endif %}
							{% if form.summary.errors %}
							<div class="invalid-feedback">{{ form.summary.errors.0 }}</div>
							{% endif %}
						</div>

						<div class="form-group">
							<label for="{{ form.posted_as.id_for_label }}" class="form-label">
								<i class="fas fa-tag me-2"></i>Publicar Como
							</label>
							{{ form.posted_as }}
							{% if form.posted_as.help_text %}
							<div class="form-text">{{ form.posted_as.help_text }}</div>
							{% endif %}
							{% if form.posted_as.errors %}
							<div class="invalid-feedback">{{ form.posted_as.errors.0 }}</div>
							{% endif %}
						</div>

						<div class="form-group">
							<label for="id_image" class="form-label">
								<i class="fas fa-image me-2"></i>Imagen (Opcional)
							</label>
							<input type="file" name="image" id="id_image" 
								   class="form-control" accept="image/*">
							<div class="form-text">Selecciona una imagen opcional para la noticia o evento</div>
						</div>

						<div class="form-actions">
							<a href="{% url 'home' %}" class="btn-cancel">
								<i class="fas fa-times me-2"></i>Cancelar
							</a>
							<button type="submit" class="btn-save">
								<i class="fas fa-save me-2"></i>Guardar
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
// Image preview functionality
document.addEventListener('DOMContentLoaded', function() {
    const imageInput = document.getElementById('id_image');
    
    if (imageInput) {
        // Create preview container
        const imagePreview = document.createElement('div');
        imagePreview.className = 'image-preview';
        imagePreview.style.display = 'none';
        
        // Add preview container after the file input
        imageInput.parentNode.insertBefore(imagePreview, imageInput.nextSibling);
        
        // Show existing image if editing
        {% if form.instance and form.instance.pk and form.instance.image %}
            const existingImage = '{{ form.instance.image.url }}';
            if (existingImage && existingImage !== '') {
                const img = document.createElement('img');
                img.src = existingImage;
                img.alt = 'Vista Previa';
                imagePreview.appendChild(img);
                imagePreview.style.display = 'block';
            }
        {% endif %}
        
        // Handle file selection
        imageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            imagePreview.innerHTML = '';
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.alt = 'Vista Previa';
                    imagePreview.appendChild(img);
                    imagePreview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                imagePreview.style.display = 'none';
            }
        });
    }
});
</script>

{% endblock content %}
