{% extends 'base.html' %}
{% load i18n %}
{% block title %} Panel de Control | Sistema de Gestión Académica {% endblock title %}
{% load static %}

{% block header %}
{% endblock %}

{% block content %}

<style>
  :root {
    --lime-400: #a3e635;
    --lime-500: #84cc16;
    --lime-600: #65a30d;
    --gray-700: #374151;
    --gray-500: #6b7280;
    --gray-300: #d1d5db;
    --glass-bg: rgba(255, 255, 255, 0.75);
    --glass-border: rgba(148, 163, 184, 0.25);
  }

  /* Contenedor principal: glass sutil y compacto */
	.dashboard-container {
    background: var(--glass-bg);
    backdrop-filter: blur(12px);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.04);
    margin: 0.75rem;
    padding: 1.25rem;
  }

  /* Migas de pan */
	.breadcrumb {
		background: transparent;
		padding: 0;
    margin-bottom: 1.25rem;
  }
  .breadcrumb-item a { color: var(--lime-600); text-decoration: none; transition: color .2s ease; }
  .breadcrumb-item a:hover { color: var(--lime-500); }
  .breadcrumb-item.active { color: var(--gray-500); }

  /* Encabezado minimalista */
	.dashboard-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
    margin-bottom: 1rem;
    padding-bottom: .5rem;
    border-bottom: 1px solid rgba(101, 163, 13, 0.15);
  }
	.title-1 {
		margin: 0;
    font-size: 1.9rem;
    font-weight: 800;
    background: linear-gradient(90deg, var(--lime-600), var(--lime-400));
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-clip: text;
	}

  /* Estadísticas: estilo similar a lecturers */
  .stats-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: .9rem; margin-bottom: 1rem; }
  .stat-card { background: rgba(255,255,255,.98); border-radius: 12px; padding: .9rem; border: 1px solid rgba(146, 182, 42, .15); box-shadow: 0 4px 16px rgba(0,0,0,.05); transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease; }
  .stat-card:hover { transform: translateY(-2px); box-shadow: 0 8px 22px rgba(0,0,0,.06); border-color: rgba(146, 182, 42, .3); }
  .stat-icon { font-size: 1.4rem; color: var(--lime-600); margin-bottom: .35rem; opacity: .9; }
  .stat-number { font-size: 1.6rem; font-weight: 800; color: var(--gray-700); line-height: 1; }
  .stat-label { font-size: .8rem; color: var(--gray-500); font-weight: 700; text-transform: uppercase; letter-spacing: .4px; }

  /* Bloques de contenido */
  .surface {
    background: rgba(255,255,255,0.7);
		backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
		border-radius: 12px;
			padding: 1rem;
    transition: border-color .22s ease, box-shadow .22s ease;
  }
  .surface:hover { border-color: rgba(101, 163, 13, 0.22); box-shadow: 0 10px 18px rgba(0,0,0,0.05); }
  .surface h5 { color: var(--gray-700); font-weight: 700; font-size: 1rem; margin-bottom: .75rem; padding-bottom: .5rem; border-bottom: 1px solid rgba(101, 163, 13, 0.18); }

  /* Tarjeta de gráfico donut pequeña */
  .chart-card { background: rgba(255,255,255,.98); border: 1px solid rgba(146, 182, 42, .12); border-radius: 12px; padding: .9rem; box-shadow: 0 4px 16px rgba(0,0,0,.05); }
  .donut-wrap { position: relative; max-width: 320px; margin: 0 auto; }
  .donut-wrap canvas { width: 100% !important; height: 160px !important; }
  .legend { display: grid; grid-template-columns: 1fr 1fr; gap: .5rem; margin-top: .6rem; }
  .legend-item { display: flex; align-items: center; gap: .5rem; font-weight: 700; color: var(--gray-700); }
  .legend-dot { width: 10px; height: 10px; border-radius: 2px; }

  /* Timeline para actividades */
  .timeline { position: relative; margin: 0; padding: 0; list-style: none; }
  .timeline::before { content: ""; position: absolute; left: 10px; top: 0; bottom: 0; width: 2px; background: rgba(148,163,184,.25); }
  .timeline-item { position: relative; padding-left: 28px; margin: .35rem 0; }
  .timeline-item .timeline-dot { position: absolute; left: 3px; top: .4rem; width: 14px; height: 14px; border-radius: 50%; background: linear-gradient(135deg, var(--lime-600), var(--lime-400)); box-shadow: 0 0 0 3px rgba(163,230,53,.2); }
  .timeline-text { color: var(--gray-700); font-weight: 600; font-size: .9rem; }
  .timeline-meta { color: var(--gray-500); font-size: .78rem; }
  .timeline-empty { color: var(--gray-500); padding-left: 28px; }

  /* Responsive fino */
  @media (max-width: 768px) {
    .dashboard-container { margin: .5rem; padding: .85rem; border-radius: 10px; }
    .title-1 { font-size: 1.5rem; }
    .stats-section { grid-template-columns: repeat(2, minmax(0,1fr)); gap: .7rem; }
    .stat-card { border-radius: 10px; padding: .75rem; }
    .stat-number { font-size: 1.5rem; }
	}
</style>

<div class="dashboard-container">
	<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
		<ol class="breadcrumb">
		  <li class="breadcrumb-item"><a href="/">Inicio</a></li>
		  <li class="breadcrumb-item active" aria-current="page">Panel de Control</li>
		</ol>
	</nav>

	{% include 'snippets/messages.html' %}

	<div class="dashboard-header">
		<h1 class="title-1">Panel de Control</h1>
	</div>

	<div class="stats-section">
		<div class="stat-card">
			<div class="stat-icon"><i class="fas fa-user-graduate"></i></div>
			<div class="stat-number">{{ student_count }}</div>
			<div class="stat-label">Estudiantes</div>
		</div>
		<div class="stat-card">
			<div class="stat-icon"><i class="fas fa-chalkboard-teacher"></i></div>
			<div class="stat-number">{{ lecturer_count }}</div>
			<div class="stat-label">Profesores</div>
		</div>
		<div class="stat-card">
			<div class="stat-icon"><i class="fas fa-user-shield"></i></div>
			<div class="stat-number">{{ superuser_count }}</div>
			<div class="stat-label">Administradores</div>
		</div>
				</div>

	<div class="row gx-2 px-1">
		<div class="col-md-6 mb-2">
			<div class="surface">
				<h5><i class="fas fa-stream me-1" style="color: var(--lime-600);"></i> Actividades recientes</h5>
				<div class="table-responsive">
					<table class="table mb-0">
						<thead>
							<tr>
								<th style="background: rgba(146,182,42,.08); border: none;">Actividad</th>
								<th style="background: rgba(146,182,42,.08); border: none; width: 160px;">Fecha</th>
							</tr>
						</thead>
						<tbody>
							{% for log in logs %}
							<tr style="border-bottom: 1px solid rgba(146,182,42,.10)">
								<td style="color: var(--gray-700); font-weight: 600;">{{ log.message }}</td>
								<td style="color: var(--gray-500);">{{ log.created_at }}</td>
							</tr>
							{% empty %}
							<tr>
								<td colspan="2" class="text-muted">No hay actividad reciente</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<div class="col-md-6 mb-2">
			<div class="chart-card">
				<h5><i class="fas fa-venus-mars me-1" style="color: var(--lime-600);"></i> Demografía escolar</h5>
				<div class="donut-wrap">
					<canvas id="gender"></canvas>
				</div>
				<div class="legend">
					<div class="legend-item"><span class="legend-dot" style="background: rgba(163,230,53,.8);"></span> {{ males_count|default:0 }} Hombres</div>
					<div class="legend-item"><span class="legend-dot" style="background: rgba(107,114,128,.6);"></span> {{ females_count|default:0 }} Mujeres</div>
				</div>
			</div>
		</div>
	</div>

    {# Se retira la sección extra de demografía estática para mantener solo datos reales #}
</div>

{% endblock content %}

{% block js %}

<script src="{% url 'javascript-catalog' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'js/dashboard.js' %}"></script>
<script>
  const malesCount = {{ males_count|default:0 }};
  const femalesCount = {{ females_count|default:0 }};

  document.addEventListener('DOMContentLoaded', function () {
    const genderCanvas = document.getElementById('gender');
    if (!genderCanvas) return;

    const dataGender = {
      labels: [gettext('Man'), gettext('Women')],
        datasets: [{
        label: gettext('Students Gender'),
            data: [malesCount, femalesCount],
        backgroundColor: ['rgba(163, 230, 53, .85)', 'rgba(107, 114, 128, .55)'],
        borderColor: ['rgba(101, 163, 13, .95)', 'rgba(75, 85, 99, .95)'],
        borderWidth: 0,
            hoverOffset: 4
        }]
    };

    new Chart(genderCanvas, {
      type: 'doughnut',
        data: dataGender,
        options: {
            plugins: {
          legend: { display: false },
          title: { display: false }
        },
        cutout: '62%'
        }
    });
  });
</script>

{% endblock %}